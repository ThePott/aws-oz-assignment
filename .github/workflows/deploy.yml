name: Build Deploy Invalidate

on:
    push:
        branches:
            - main
# 할 것
# 1. 인증
# 2. s3 버킷 비우기
# 3. repo download
# 4. npm install
# 5. npm run build
# 6. dist 폴더 내용물 s3에 올리기
# 7. cloudfront invalidate cache

jobs:
    My-CI-CD-Jobs:
        runs-on: ubuntu-latest
        steps:
            # https://github.com/actions/checkout
            - name: 깃헙에서 레포 다운받기
              uses: actions/checkout@v5
        
            - name: 진짜 다운 됐나?
              run: ls
            
            - name: 의존성 설치, 빌드
              run: |
                npm install
                npm run build
            
            - name: dist 폴더 확인
              run: |
                cd dist
                ls
            
            # https://github.com/aws-actions/configure-aws-credentials
            # aws console에서 현재 지역을 확인할 수 있음
            - name: Configure AWS Credentials
              uses: aws-actions/configure-aws-credentials@main # Or a specific version
              with:
                aws-region: ap-northeast-2
                aws-access-key-id: ${{secrets.AWS_ACCESS_KEY}}
                aws-secret-access-key: ${{secrets.AWS_SECRET_ACCESS_KEY}}

            - name: S3 버켓에 있는 모든 파일 삭제
              run: |
                aws rm -r s3://aws-oz-assignment
